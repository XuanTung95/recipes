[
  {
    "cmd": [],
    "name": "launch builds"
  },
  {
    "cmd": [
      "bb",
      "batch",
      "-host",
      "cr-buildbucket.appspot.com"
    ],
    "infra_step": true,
    "name": "launch builds.schedule",
    "stdin": "{\"requests\": [{\"scheduleBuild\": {\"builder\": {\"bucket\": \"try\", \"builder\": \"Linux Staging Engine Drone\", \"project\": \"fuchsia\"}, \"dimensions\": [{\"key\": \"dimension1\", \"value\": \"abc\"}], \"experimental\": \"NO\", \"fields\": \"builder,createTime,createdBy,critical,endTime,id,input,number,output,startTime,status,updateTime\", \"gerritChanges\": [{\"change\": \"123456\", \"host\": \"fuchsia-review.googlesource.com\", \"patchset\": \"7\", \"project\": \"fuchsia\"}], \"priority\": 25, \"properties\": {\"build\": {\"drone_dimensions\": [\"dimension1=abc\"], \"generators\": [{\"name\": \"generator1\", \"script\": \"script1.sh\"}], \"gn\": [\"--ios\"], \"name\": \"ios_debug\", \"ninja\": {\"config\": \"ios_debug\", \"targets\": []}}, \"builds\": [{\"drone_dimensions\": [\"dimension1=abc\"], \"generators\": [{\"name\": \"generator1\", \"script\": \"script1.sh\"}], \"gn\": [\"--ios\"], \"name\": \"ios_debug\", \"ninja\": {\"config\": \"ios_debug\", \"targets\": []}}], \"dependencies\": [{\"dependency\": \"android_sdk\"}, {\"dependency\": \"chrome_and_driver\"}], \"environment\": \"Staging\", \"git_ref\": \"refs/123/master\", \"git_url\": \"http://abc\", \"recipe\": \"engine_v2/builder\", \"task_name\": \"mytask\", \"tests\": [{\"dependencies\": [\"ios_debug\"], \"name\": \"felt_test\", \"parameters\": [\"test\"], \"scripts\": [\"out/script.sh\"]}]}, \"requestId\": \"8945511751514863184-00000000-0000-0000-0000-000000001337\", \"swarming\": {\"parentRunId\": \"fake-task-id\"}, \"tags\": [{\"key\": \"cq_experimental\", \"value\": \"false\"}, {\"key\": \"user_agent\", \"value\": \"recipe\"}]}}]}",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"responses\": [@@@",
      "@@@STEP_LOG_LINE@json.output@    {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"scheduleBuild\": {@@@",
      "@@@STEP_LOG_LINE@json.output@        \"builder\": {@@@",
      "@@@STEP_LOG_LINE@json.output@          \"bucket\": \"try\", @@@",
      "@@@STEP_LOG_LINE@json.output@          \"builder\": \"builder-subbuild2\", @@@",
      "@@@STEP_LOG_LINE@json.output@          \"project\": \"fuchsia\"@@@",
      "@@@STEP_LOG_LINE@json.output@        }, @@@",
      "@@@STEP_LOG_LINE@json.output@        \"id\": \"8945511751514863187\"@@@",
      "@@@STEP_LOG_LINE@json.output@      }@@@",
      "@@@STEP_LOG_LINE@json.output@    }@@@",
      "@@@STEP_LOG_LINE@json.output@  ]@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@",
      "@@@STEP_LOG_LINE@request@{@@@",
      "@@@STEP_LOG_LINE@request@  \"requests\": [@@@",
      "@@@STEP_LOG_LINE@request@    {@@@",
      "@@@STEP_LOG_LINE@request@      \"scheduleBuild\": {@@@",
      "@@@STEP_LOG_LINE@request@        \"builder\": {@@@",
      "@@@STEP_LOG_LINE@request@          \"bucket\": \"try\", @@@",
      "@@@STEP_LOG_LINE@request@          \"builder\": \"Linux Staging Engine Drone\", @@@",
      "@@@STEP_LOG_LINE@request@          \"project\": \"fuchsia\"@@@",
      "@@@STEP_LOG_LINE@request@        }, @@@",
      "@@@STEP_LOG_LINE@request@        \"dimensions\": [@@@",
      "@@@STEP_LOG_LINE@request@          {@@@",
      "@@@STEP_LOG_LINE@request@            \"key\": \"dimension1\", @@@",
      "@@@STEP_LOG_LINE@request@            \"value\": \"abc\"@@@",
      "@@@STEP_LOG_LINE@request@          }@@@",
      "@@@STEP_LOG_LINE@request@        ], @@@",
      "@@@STEP_LOG_LINE@request@        \"experimental\": \"NO\", @@@",
      "@@@STEP_LOG_LINE@request@        \"fields\": \"builder,createTime,createdBy,critical,endTime,id,input,number,output,startTime,status,updateTime\", @@@",
      "@@@STEP_LOG_LINE@request@        \"gerritChanges\": [@@@",
      "@@@STEP_LOG_LINE@request@          {@@@",
      "@@@STEP_LOG_LINE@request@            \"change\": \"123456\", @@@",
      "@@@STEP_LOG_LINE@request@            \"host\": \"fuchsia-review.googlesource.com\", @@@",
      "@@@STEP_LOG_LINE@request@            \"patchset\": \"7\", @@@",
      "@@@STEP_LOG_LINE@request@            \"project\": \"fuchsia\"@@@",
      "@@@STEP_LOG_LINE@request@          }@@@",
      "@@@STEP_LOG_LINE@request@        ], @@@",
      "@@@STEP_LOG_LINE@request@        \"priority\": 25, @@@",
      "@@@STEP_LOG_LINE@request@        \"properties\": {@@@",
      "@@@STEP_LOG_LINE@request@          \"build\": {@@@",
      "@@@STEP_LOG_LINE@request@            \"drone_dimensions\": [@@@",
      "@@@STEP_LOG_LINE@request@              \"dimension1=abc\"@@@",
      "@@@STEP_LOG_LINE@request@            ], @@@",
      "@@@STEP_LOG_LINE@request@            \"generators\": [@@@",
      "@@@STEP_LOG_LINE@request@              {@@@",
      "@@@STEP_LOG_LINE@request@                \"name\": \"generator1\", @@@",
      "@@@STEP_LOG_LINE@request@                \"script\": \"script1.sh\"@@@",
      "@@@STEP_LOG_LINE@request@              }@@@",
      "@@@STEP_LOG_LINE@request@            ], @@@",
      "@@@STEP_LOG_LINE@request@            \"gn\": [@@@",
      "@@@STEP_LOG_LINE@request@              \"--ios\"@@@",
      "@@@STEP_LOG_LINE@request@            ], @@@",
      "@@@STEP_LOG_LINE@request@            \"name\": \"ios_debug\", @@@",
      "@@@STEP_LOG_LINE@request@            \"ninja\": {@@@",
      "@@@STEP_LOG_LINE@request@              \"config\": \"ios_debug\", @@@",
      "@@@STEP_LOG_LINE@request@              \"targets\": []@@@",
      "@@@STEP_LOG_LINE@request@            }@@@",
      "@@@STEP_LOG_LINE@request@          }, @@@",
      "@@@STEP_LOG_LINE@request@          \"builds\": [@@@",
      "@@@STEP_LOG_LINE@request@            {@@@",
      "@@@STEP_LOG_LINE@request@              \"drone_dimensions\": [@@@",
      "@@@STEP_LOG_LINE@request@                \"dimension1=abc\"@@@",
      "@@@STEP_LOG_LINE@request@              ], @@@",
      "@@@STEP_LOG_LINE@request@              \"generators\": [@@@",
      "@@@STEP_LOG_LINE@request@                {@@@",
      "@@@STEP_LOG_LINE@request@                  \"name\": \"generator1\", @@@",
      "@@@STEP_LOG_LINE@request@                  \"script\": \"script1.sh\"@@@",
      "@@@STEP_LOG_LINE@request@                }@@@",
      "@@@STEP_LOG_LINE@request@              ], @@@",
      "@@@STEP_LOG_LINE@request@              \"gn\": [@@@",
      "@@@STEP_LOG_LINE@request@                \"--ios\"@@@",
      "@@@STEP_LOG_LINE@request@              ], @@@",
      "@@@STEP_LOG_LINE@request@              \"name\": \"ios_debug\", @@@",
      "@@@STEP_LOG_LINE@request@              \"ninja\": {@@@",
      "@@@STEP_LOG_LINE@request@                \"config\": \"ios_debug\", @@@",
      "@@@STEP_LOG_LINE@request@                \"targets\": []@@@",
      "@@@STEP_LOG_LINE@request@              }@@@",
      "@@@STEP_LOG_LINE@request@            }@@@",
      "@@@STEP_LOG_LINE@request@          ], @@@",
      "@@@STEP_LOG_LINE@request@          \"dependencies\": [@@@",
      "@@@STEP_LOG_LINE@request@            {@@@",
      "@@@STEP_LOG_LINE@request@              \"dependency\": \"android_sdk\"@@@",
      "@@@STEP_LOG_LINE@request@            }, @@@",
      "@@@STEP_LOG_LINE@request@            {@@@",
      "@@@STEP_LOG_LINE@request@              \"dependency\": \"chrome_and_driver\"@@@",
      "@@@STEP_LOG_LINE@request@            }@@@",
      "@@@STEP_LOG_LINE@request@          ], @@@",
      "@@@STEP_LOG_LINE@request@          \"environment\": \"Staging\", @@@",
      "@@@STEP_LOG_LINE@request@          \"git_ref\": \"refs/123/master\", @@@",
      "@@@STEP_LOG_LINE@request@          \"git_url\": \"http://abc\", @@@",
      "@@@STEP_LOG_LINE@request@          \"recipe\": \"engine_v2/builder\", @@@",
      "@@@STEP_LOG_LINE@request@          \"task_name\": \"mytask\", @@@",
      "@@@STEP_LOG_LINE@request@          \"tests\": [@@@",
      "@@@STEP_LOG_LINE@request@            {@@@",
      "@@@STEP_LOG_LINE@request@              \"dependencies\": [@@@",
      "@@@STEP_LOG_LINE@request@                \"ios_debug\"@@@",
      "@@@STEP_LOG_LINE@request@              ], @@@",
      "@@@STEP_LOG_LINE@request@              \"name\": \"felt_test\", @@@",
      "@@@STEP_LOG_LINE@request@              \"parameters\": [@@@",
      "@@@STEP_LOG_LINE@request@                \"test\"@@@",
      "@@@STEP_LOG_LINE@request@              ], @@@",
      "@@@STEP_LOG_LINE@request@              \"scripts\": [@@@",
      "@@@STEP_LOG_LINE@request@                \"out/script.sh\"@@@",
      "@@@STEP_LOG_LINE@request@              ]@@@",
      "@@@STEP_LOG_LINE@request@            }@@@",
      "@@@STEP_LOG_LINE@request@          ]@@@",
      "@@@STEP_LOG_LINE@request@        }, @@@",
      "@@@STEP_LOG_LINE@request@        \"requestId\": \"8945511751514863184-00000000-0000-0000-0000-000000001337\", @@@",
      "@@@STEP_LOG_LINE@request@        \"swarming\": {@@@",
      "@@@STEP_LOG_LINE@request@          \"parentRunId\": \"fake-task-id\"@@@",
      "@@@STEP_LOG_LINE@request@        }, @@@",
      "@@@STEP_LOG_LINE@request@        \"tags\": [@@@",
      "@@@STEP_LOG_LINE@request@          {@@@",
      "@@@STEP_LOG_LINE@request@            \"key\": \"cq_experimental\", @@@",
      "@@@STEP_LOG_LINE@request@            \"value\": \"false\"@@@",
      "@@@STEP_LOG_LINE@request@          }, @@@",
      "@@@STEP_LOG_LINE@request@          {@@@",
      "@@@STEP_LOG_LINE@request@            \"key\": \"user_agent\", @@@",
      "@@@STEP_LOG_LINE@request@            \"value\": \"recipe\"@@@",
      "@@@STEP_LOG_LINE@request@          }@@@",
      "@@@STEP_LOG_LINE@request@        ]@@@",
      "@@@STEP_LOG_LINE@request@      }@@@",
      "@@@STEP_LOG_LINE@request@    }@@@",
      "@@@STEP_LOG_LINE@request@  ]@@@",
      "@@@STEP_LOG_LINE@request@}@@@",
      "@@@STEP_LOG_END@request@@@",
      "@@@STEP_LINK@8945511751514863187@https://cr-buildbucket.appspot.com/build/8945511751514863187@@@"
    ]
  },
  {
    "cmd": [],
    "name": "collect builds",
    "~followup_annotations": [
      "@@@STEP_FAILURE@@@"
    ]
  },
  {
    "cmd": [],
    "name": "collect builds.collect",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@"
    ]
  },
  {
    "cmd": [
      "bb",
      "collect",
      "-host",
      "cr-buildbucket.appspot.com",
      "-interval",
      "20s",
      "8945511751514863187"
    ],
    "infra_step": true,
    "name": "collect builds.collect.wait",
    "timeout": 86400,
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@2@@@"
    ]
  },
  {
    "cmd": [
      "bb",
      "batch",
      "-host",
      "cr-buildbucket.appspot.com"
    ],
    "infra_step": true,
    "name": "collect builds.collect.get",
    "stdin": "{\"requests\": [{\"getBuild\": {\"fields\": \"builder,createTime,createdBy,critical,endTime,id,infra.swarming.taskId,input,number,output,startTime,status,summaryMarkdown,updateTime\", \"id\": \"8945511751514863187\"}}]}",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@2@@@",
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"responses\": [@@@",
      "@@@STEP_LOG_LINE@json.output@    {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"getBuild\": {@@@",
      "@@@STEP_LOG_LINE@json.output@        \"builder\": {@@@",
      "@@@STEP_LOG_LINE@json.output@          \"bucket\": \"try\", @@@",
      "@@@STEP_LOG_LINE@json.output@          \"builder\": \"builder-subbuild2\", @@@",
      "@@@STEP_LOG_LINE@json.output@          \"project\": \"fuchsia\"@@@",
      "@@@STEP_LOG_LINE@json.output@        }, @@@",
      "@@@STEP_LOG_LINE@json.output@        \"createTime\": \"2018-05-25T23:50:17Z\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"createdBy\": \"user:commit-bot@chromium.org\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"id\": \"8945511751514863187\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"infra\": {@@@",
      "@@@STEP_LOG_LINE@json.output@          \"resultdb\": {@@@",
      "@@@STEP_LOG_LINE@json.output@            \"invocation\": \"invocations/build:8945511751514863187\"@@@",
      "@@@STEP_LOG_LINE@json.output@          }, @@@",
      "@@@STEP_LOG_LINE@json.output@          \"swarming\": {@@@",
      "@@@STEP_LOG_LINE@json.output@            \"priority\": 30, @@@",
      "@@@STEP_LOG_LINE@json.output@            \"taskId\": \"abc123\"@@@",
      "@@@STEP_LOG_LINE@json.output@          }@@@",
      "@@@STEP_LOG_LINE@json.output@        }, @@@",
      "@@@STEP_LOG_LINE@json.output@        \"input\": {@@@",
      "@@@STEP_LOG_LINE@json.output@          \"gerritChanges\": [@@@",
      "@@@STEP_LOG_LINE@json.output@            {@@@",
      "@@@STEP_LOG_LINE@json.output@              \"change\": \"123456\", @@@",
      "@@@STEP_LOG_LINE@json.output@              \"host\": \"chromium-review.googlesource.com\", @@@",
      "@@@STEP_LOG_LINE@json.output@              \"patchset\": \"7\", @@@",
      "@@@STEP_LOG_LINE@json.output@              \"project\": \"fuchsia\"@@@",
      "@@@STEP_LOG_LINE@json.output@            }@@@",
      "@@@STEP_LOG_LINE@json.output@          ]@@@",
      "@@@STEP_LOG_LINE@json.output@        }, @@@",
      "@@@STEP_LOG_LINE@json.output@        \"output\": {@@@",
      "@@@STEP_LOG_LINE@json.output@          \"properties\": {@@@",
      "@@@STEP_LOG_LINE@json.output@            \"cas_output_hash\": {@@@",
      "@@@STEP_LOG_LINE@json.output@              \"ios_debug\": \"bcd\", @@@",
      "@@@STEP_LOG_LINE@json.output@              \"web_tests\": \"abc\"@@@",
      "@@@STEP_LOG_LINE@json.output@            }@@@",
      "@@@STEP_LOG_LINE@json.output@          }@@@",
      "@@@STEP_LOG_LINE@json.output@        }, @@@",
      "@@@STEP_LOG_LINE@json.output@        \"status\": \"FAILURE\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"tags\": [@@@",
      "@@@STEP_LOG_LINE@json.output@          {@@@",
      "@@@STEP_LOG_LINE@json.output@            \"key\": \"cq_experimental\", @@@",
      "@@@STEP_LOG_LINE@json.output@            \"value\": \"false\"@@@",
      "@@@STEP_LOG_LINE@json.output@          }@@@",
      "@@@STEP_LOG_LINE@json.output@        ]@@@",
      "@@@STEP_LOG_LINE@json.output@      }@@@",
      "@@@STEP_LOG_LINE@json.output@    }@@@",
      "@@@STEP_LOG_LINE@json.output@  ]@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@",
      "@@@STEP_LOG_LINE@request@{@@@",
      "@@@STEP_LOG_LINE@request@  \"requests\": [@@@",
      "@@@STEP_LOG_LINE@request@    {@@@",
      "@@@STEP_LOG_LINE@request@      \"getBuild\": {@@@",
      "@@@STEP_LOG_LINE@request@        \"fields\": \"builder,createTime,createdBy,critical,endTime,id,infra.swarming.taskId,input,number,output,startTime,status,summaryMarkdown,updateTime\", @@@",
      "@@@STEP_LOG_LINE@request@        \"id\": \"8945511751514863187\"@@@",
      "@@@STEP_LOG_LINE@request@      }@@@",
      "@@@STEP_LOG_LINE@request@    }@@@",
      "@@@STEP_LOG_LINE@request@  ]@@@",
      "@@@STEP_LOG_LINE@request@}@@@",
      "@@@STEP_LOG_END@request@@@",
      "@@@STEP_LINK@8945511751514863187@https://cr-buildbucket.appspot.com/build/8945511751514863187@@@"
    ]
  },
  {
    "cmd": [],
    "name": "collect builds.install infra/tools/luci/swarming",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@"
    ]
  },
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "ensure-directory",
      "--mode",
      "0777",
      "[CACHE]/cipd/infra/tools/luci/swarming/swarming_module_pin"
    ],
    "infra_step": true,
    "name": "collect builds.install infra/tools/luci/swarming.ensure package directory",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@2@@@"
    ]
  },
  {
    "cmd": [
      "cipd",
      "ensure",
      "-root",
      "[CACHE]/cipd/infra/tools/luci/swarming/swarming_module_pin",
      "-ensure-file",
      "infra/tools/luci/swarming/${platform} swarming_module_pin",
      "-max-threads",
      "0",
      "-json-output",
      "/path/to/tmp/json"
    ],
    "infra_step": true,
    "name": "collect builds.install infra/tools/luci/swarming.ensure_installed",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@2@@@",
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"result\": {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"\": [@@@",
      "@@@STEP_LOG_LINE@json.output@      {@@@",
      "@@@STEP_LOG_LINE@json.output@        \"instance_id\": \"resolved-instance_id-of-swarming_module_\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"package\": \"infra/tools/luci/swarming/resolved-platform\"@@@",
      "@@@STEP_LOG_LINE@json.output@      }@@@",
      "@@@STEP_LOG_LINE@json.output@    ]@@@",
      "@@@STEP_LOG_LINE@json.output@  }@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@"
    ]
  },
  {
    "cmd": [
      "[CACHE]/cipd/infra/tools/luci/swarming/swarming_module_pin/swarming",
      "collect",
      "-server",
      "https://example.swarmingserver.appspot.com",
      "-task-summary-json",
      "/path/to/tmp/json",
      "-task-output-stdout",
      "json",
      "abc123"
    ],
    "infra_step": true,
    "name": "collect builds.wait for 1 task to complete",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"abc123\": {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"output\": \"hello world!\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"outputs\": [], @@@",
      "@@@STEP_LOG_LINE@json.output@    \"results\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"bot_id\": \"vm-123\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"duration\": 62.35, @@@",
      "@@@STEP_LOG_LINE@json.output@      \"exit_code\": 0, @@@",
      "@@@STEP_LOG_LINE@json.output@      \"name\": \"my_task_0\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"outputs_ref\": {@@@",
      "@@@STEP_LOG_LINE@json.output@        \"isolated\": \"abc123\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"isolatedserver\": \"https://isolateserver.appspot.com\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"namespace\": \"default-gzip\"@@@",
      "@@@STEP_LOG_LINE@json.output@      }, @@@",
      "@@@STEP_LOG_LINE@json.output@      \"state\": \"COMPLETED\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"task_id\": \"abc123\"@@@",
      "@@@STEP_LOG_LINE@json.output@    }@@@",
      "@@@STEP_LOG_LINE@json.output@  }@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@",
      "@@@STEP_LOG_LINE@task stdout+stderr: my_task_0@hello world!@@@",
      "@@@STEP_LOG_END@task stdout+stderr: my_task_0@@@",
      "@@@STEP_LINK@task isolated outputs: my_task_0@https://isolateserver.appspot.com/browse?namespace=default-gzip&hash=abc123@@@"
    ]
  },
  {
    "failure": {
      "failure": {},
      "humanReason": "build 8945511751514863187 failed"
    },
    "name": "$result"
  }
]